!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.menrva=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var signal=require("./signal.js");signal.Signal.prototype.log=function(){var args=Array.prototype.slice.call(arguments);return this.onValue(function(x){var logArgs=args.concat([x]);console.log.apply(console,logArgs)})};signal.Signal.prototype.onSpread=function(callback){return this.onValue(function(t){callback.apply(undefined,t)})};function argsToArray(){return Array.prototype.slice.call(arguments)}function tuple(){var signals=Array.prototype.slice.call(arguments);var args=signals.concat([argsToArray]);return signal.combine.apply(signal,args)}module.exports={tuple:tuple}},{"./signal.js":6}],2:[function(require,module,exports){"use strict";function egal(a,b){if(a===0&&b===0){return 1/a===1/b}else if(a!==a){return b!==b}else{return a===b}}module.exports=egal},{}],3:[function(require,module,exports){"use strict";var util=require("./util.js");var signal=require("./signal.js");function Lens(parent,path,eq){this.parents=[parent];this.path=path.split(/\./);var value=this.calculate();signal.initSignal(this,value,eq)}Lens.prototype=new signal.Signal;Lens.prototype.calculateRank=function(){return this.parents[0].rank+1};Lens.prototype.calculate=function(){return util.getPath(this.parents[0].value,this.path)};signal.Source.prototype.zoom=Lens.prototype.zoom=function(f,eq){var mapped=new Lens(this,f,eq);this.children.push(mapped);return mapped};Lens.prototype.set=function(tx,value){var path=this.path;this.parents[0].modify(tx,function(obj){return util.setPath(obj,path,value)})};Lens.prototype.modify=function(tx,f){var path=this.path;this.parents[0].modify(tx,function(obj){return util.modifyPath(obj,path,f)})}},{"./signal.js":6,"./util.js":8}],4:[function(require,module,exports){"use strict";var egal=require("./egal.js");var option=require("./option.js");var signal=require("./signal.js");var transaction=require("./transaction.js");require("./lens.js");var convenience=require("./convenience.js");var version="0.0.6";module.exports={egal:egal,some:option.some,none:option.none,Signal:signal.Signal,source:signal.source,combine:signal.combine,tuple:convenience.tuple,transaction:transaction,version:version}},{"./convenience.js":1,"./egal.js":2,"./lens.js":3,"./option.js":5,"./signal.js":6,"./transaction.js":7}],5:[function(require,module,exports){"use strict";var egal=require("./egal.js");var util=require("./util.js");function Option(){}function Some(x){this.value=x}Some.prototype=new Option;function some(x){return new Some(x)}function None(){}None.prototype=new Option;var none=new None;Some.prototype.equals=function(other,eq){eq=eq||egal;return other instanceof Some&&eq(this.value,other.value)};None.prototype.equals=function(other){return this===other};Some.prototype.map=function(f){return some(f(this.value))};None.prototype.map=function(f){return none};Some.prototype.elim=function(x,f){return f(this.value)};None.prototype.elim=function(x,f){return x};Option.prototype.orElse=function(x){return this.elim(x,util.identity)};module.exports={some:some,none:none}},{"./egal.js":2,"./util.js":8}],6:[function(require,module,exports){"use strict";var egal=require("./egal.js");var util=require("./util.js");function Signal(){}var index=0;function initSignal(signal,value,eq){signal.children=[];signal.callbacks=[];signal.value=value;signal.index=index++;signal.rank=signal.calculateRank();signal.eq=eq||egal}function CombinedSignal(parents,f,eq){this.parents=parents;this.f=f;var value=this.calculate();initSignal(this,value,eq)}CombinedSignal.prototype=new Signal;CombinedSignal.prototype.calculateRank=function(){return Math.max.apply(Math,util.pluck(this.parents,"rank"))+1};CombinedSignal.prototype.calculate=function(){return this.f.apply(undefined,util.pluck(this.parents,"value"))};Signal.prototype.map=function(f,eq){var mapped=new CombinedSignal([this],f,eq);this.children.push(mapped);return mapped};Signal.prototype.onValue=function(callback){var wrapped=function(x){callback(x)};this.callbacks.push(wrapped);callback(this.value);var that=this;return function(){var index=that.callbacks.indexOf(wrapped);if(index!==-1){that.callbacks.splice(index,1)}}};function Source(initialValue,eq){initSignal(this,initialValue,eq)}function source(initialValue,eq){return new Source(initialValue,eq)}Source.prototype=new Signal;Source.prototype.calculateRank=function(){return 0};Source.prototype.set=function(transaction,value){transaction.addAction({type:"set",signal:this,value:value})};Source.prototype.modify=function(transaction,f){transaction.addAction({type:"modify",signal:this,f:f})};function combine(){var signals=Array.prototype.slice.call(arguments,0,-1);var f=arguments[arguments.length-1];var mapped=new CombinedSignal(signals,f);signals.forEach(function(parent){parent.children.push(mapped)});return mapped}module.exports={Signal:Signal,Source:Source,source:source,combine:combine,initSignal:initSignal}},{"./egal.js":2,"./util.js":8}],7:[function(require,module,exports){"use strict";var util=require("./util.js");function Transaction(){this.actions=[];this.commitScheduled=false}function transaction(facts){var tx=new Transaction;if(Array.isArray(facts)){var len=facts.length;for(var i=0;i<len;i+=2){var source=facts[i];var value=facts[i+1];if(typeof value==="function"){source.modify(tx,value)}else{source.set(tx,value)}}}return tx}function calculateUpdates(actions){var updates={};var len=actions.length;for(var i=0;i<len;i++){var action=actions[i];var update=updates[action.signal.index];if(!update){update={signal:action.signal,value:action.signal.value};updates[action.signal.index]=update}switch(action.type){case"set":update.value=action.value;break;case"modify":update.value=action.f(update.value);break}}return util.values(updates)}function initialSet(updates){var updated=[];var len=updates.length;for(var i=0;i<len;i++){var update=updates[i];if(!update.signal.eq(update.signal.value,update.value)){update.signal.value=update.value;updated.push(update.signal)}}return updated}function triggerOnValue(updated){var len=updated.length;for(var i=0;i<len;i++){var updatedSignal=updated[i];var value=updatedSignal.value;var callbacks=updatedSignal.callbacks;var callbacksLen=callbacks.length;for(var j=0;j<callbacksLen;j++){callbacks[j](value)}}}Transaction.prototype.commit=function(){if(this.commitScheduled){clearTimeout(this.commitScheduled);this.commitScheduled=false}if(this.actions.length===0){return}var updates=calculateUpdates(this.actions);var updated=initialSet(updates);var signals={};updated.forEach(function(update){update.children.forEach(function(child){signals[child.index]=child})});while(!util.objIsEmpty(signals)){var rank=Infinity;for(var rankK in signals){rank=Math.min(rank,signals[rankK].rank)}var next=[];var curr=[];for(var k in signals){var signal=signals[k];if(signal.rank!==rank){continue}var value=signal.calculate();if(!signal.eq(signal.value,value)){signal.value=value;updated.push(signal);var childrenlen=signal.children.length;for(var childIdx=0;childIdx<childrenlen;childIdx++){var child=signal.children[childIdx];next.push(child)}}curr.push(signal.index)}var currLen=curr.length;for(var currIdx=0;currIdx<currLen;currIdx++){delete signals[curr[currIdx]]}var nextLen=next.length;for(var nextIdx=0;nextIdx<nextLen;nextIdx++){signals[next[nextIdx].index]=next[nextIdx]}}triggerOnValue(updated);this.actions=[]};Transaction.prototype.rollback=function(){if(this.commitScheduled){clearTimeout(this.commitScheduled)}this.actions=[];this.commitScheduled=false};Transaction.prototype.deferCommit=function(){if(!this.commitScheduled){var tx=this;this.commitScheduled=setTimeout(function(){tx.commit()})}};Transaction.prototype.addAction=function(action){this.actions.push(action);this.deferCommit()};Transaction.prototype.set=function(source,value){source.set(this,value);return this};Transaction.prototype.modify=function(source,f){source.modify(this,f);return this};module.exports=transaction},{"./util.js":8}],8:[function(require,module,exports){"use strict";function identity(x){return x}function pluck(arr,property){var len=arr.length;var res=new Array(len);for(var i=0;i<len;i++){res[i]=arr[i][property]}return res}function values(obj){var arr=[];for(var k in obj){arr.push(obj[k])}return arr}function objIsEmpty(obj){for(var k in obj){return false}return true}function getPath(obj,path){var len=path.length;for(var i=0;i<len;i++){if(obj===undefined||obj===null){return obj}else{obj=obj[path[i]]}}return obj}function setProperty(obj,property,value){var copy={};for(var k in obj){copy[k]=obj[k]}copy[property]=value;return copy}function setPath(obj,path,value){var len=path.length;var acc=value;for(var i=len;i>0;i--){var next=getPath(obj,path.slice(0,i-1));acc=setProperty(next,path[i-1],acc)}return acc}function modifyPath(obj,path,f){return setPath(obj,path,f(getPath(obj,path)))}module.exports={identity:identity,pluck:pluck,values:values,objIsEmpty:objIsEmpty,getPath:getPath,setPath:setPath,modifyPath:modifyPath}},{}]},{},[4])(4)});
//# sourceMappingURL=dist/menrva.min.js.map